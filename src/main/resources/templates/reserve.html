<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Reservas</title>
    <link rel="icon" th:href="@{/images/image-favicon.jpg}" type="image/png">
    <link rel="stylesheet" th:href="@{/css/reserve.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <h1 class="logo">Interactive Edge</h1>
            <nav class="nav">
                <a href="/" class="nav-link"><i class="fas fa-home"></i> Dashboard</a>
                <a href="/guest" class="nav-link"><i class="fas fa-users"></i> Hóspedes</a>
                <a href="/room" class="nav-link"><i class="fas fa-bed"></i> Quartos</a>
                <div class="dropdown">
                    <a class="nav-link dropdown-link active"><i class="fas fa-cog"></i> Gerenciar</a>
                    <div class="dropdown-content">
                        <a href="/reserve"><i class="fas fa-calendar-check"></i> Reservas</a>
                        <a href="/financas"><i class="fas fa-chart-line"></i> Finanças</a>
                        <a th:href="@{/funcionarios}"><i class="fas fa-user-tie"></i> Funcionários</a>
                    </div>
                </div>
                <a href="/calendario" class="btn-calendar" style="display: inline-block; padding: 0.4rem 0.8rem; margin-left: 1rem;">
                    <i class="fas fa-calendar"></i> Calendário
                </a>
                <div class="user-info" id="userInfo">
                    <!-- Informações do usuário serão carregadas aqui -->
                </div>
                <a href="#" class="nav-link" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Sair</a>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- Cabeçalho da Página -->
            <div class="card">
                <div class="page-header">
                    <div>
                        <h2 class="card-title">Gerenciar Reservas</h2>
                        <p>Gerencie todas as reservas Interactive Edge</p>
                    </div>
                    <div class="quick-actions">
                        <button class="btn btn-primary" onclick="reservationManager.openCreateModal()">
                            <i class="fas fa-plus"></i> Nova Reserva
                        </button>
                    </div>
                </div>
            </div>

            <!-- Busca de Reservas -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Buscar Reservas</h3>
                </div>
                <div class="form-group">
                    <input type="text" id="searchInput" class="form-control" 
                           placeholder="Digite o ID da reserva ou nome do hóspede...">
                </div>
                <div id="searchResults" class="search-results-container"></div>
            </div>

            <!-- Lista de Reservas -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Lista de Reservas</h3>
                </div>
                
                <!-- Container expansível para a lista de reservas -->
                <div class="expandable-list collapsed" id="reservationListContainer">
                    <div id="reservationList">
                        <div class="loading-reservations">
                            <div class="loading-spinner"></div>
                            Carregando reservas...
                        </div>
                    </div>
                </div>
                
                <!-- Botão para expandir/recolher -->
                <div class="show-all-container">
                    <button class="btn btn-show-all" onclick="reservationManager.toggleReservationList()">
                        Mostrar Todos
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para Nova Reserva (FLUXO COMPLETO) -->
    <div id="createReservationModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="card-title">Nova Reserva - Fluxo de Criação</h3>
                <span class="close" onclick="reservationManager.closeCreateModal()">&times;</span>
            </div>
            
            <!-- Indicador de Passos -->
            <div class="step-indicator">
                <div class="step-line"></div>
                <div class="step active" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-label">Cadastrar Hóspedes</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-label">Selecionar Quarto</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-label">Selecionar Datas</div>
                </div>
                <div class="step" id="step4">
                    <div class="step-number">4</div>
                    <div class="step-label">Confirmar</div>
                </div>
            </div>

            <div class="creation-flow">
                <!-- PASSO 1: Cadastro de Hóspedes -->
                <div class="flow-section active" id="step1-content">
                    <div class="guest-creation-card">
                        <h4 class="section-title"><i class="fas fa-users"></i> Cadastrar Hóspedes</h4>
                        
                        <div class="guest-form">
                            <div class="form-group">
                                <label class="form-label">Nome Completo *</label>
                                <input type="text" id="guestName" class="form-control" placeholder="Nome do hóspede">
                            </div>
                            <div class="form-group">
                                <label class="form-label">RG *</label>
                                <input type="text" id="guestRg" class="form-control" placeholder="Número do RG">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Telefone *</label>
                                <input type="text" id="guestPhone" class="form-control" placeholder="(00) 00000-0000">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" id="guestEmail" class="form-control" placeholder="email@exemplo.com">
                            </div>
                        </div>
                        
                        <button class="btn btn-success" onclick="reservationManager.addGuestToList()">
                            <i class="fas fa-plus"></i> Adicionar Hóspede
                        </button>

                        <!-- Lista de Hóspedes Cadastrados -->
                        <div class="guest-list-container" id="guestListContainer">
                            <h5>Hóspedes Cadastrados:</h5>
                            <div id="guestList">
                                <p style="color: #666; font-style: italic; text-align: center; padding: 2rem;">
                                    Nenhum hóspede cadastrado ainda
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="navigation-buttons">
                        <div></div>
                        <button class="btn btn-primary" onclick="reservationManager.goToStep(2)">
                            Próximo <i class="fas fa-arrow-right"></i> Selecionar Quarto
                        </button>
                    </div>
                </div>

                <!-- PASSO 2: Seleção de Quarto -->
                <div class="flow-section" id="step2-content">
                    <div class="card">
                        <h4 class="section-title"><i class="fas fa-bed"></i> Selecionar Quarto</h4>
                        <div class="form-group">
                            <label class="form-label">Número do Quarto *</label>
                            <input type="number" id="roomNumber" class="form-control" placeholder="Digite o número do quarto">
                        </div>
                        <div class="form-group">
                            <small style="color: #666;">
                                <i class="fas fa-lightbulb"></i> Dica: Verifique a disponibilidade do quarto antes de prosseguir
                            </small>
                        </div>
                    </div>

                    <div class="navigation-buttons">
                        <button class="btn btn-secondary" onclick="reservationManager.goToStep(1)">
                            <i class="fas fa-arrow-left"></i> Voltar
                        </button>
                        <button class="btn btn-primary" onclick="reservationManager.goToStep(3)">
                            Próximo <i class="fas fa-arrow-right"></i> Selecionar Datas
                        </button>
                    </div>
                </div>

                <!-- PASSO 3: Seleção de Datas -->
                <div class="flow-section" id="step3-content">
                    <div class="card">
                        <h4 class="section-title"><i class="fas fa-calendar-alt"></i> Selecionar Datas da Reserva</h4>
                        
                        <div class="date-picker-container">
                            <div class="date-input-group">
                                <label class="form-label">Adicionar Data</label>
                                <input type="date" id="singleDateInput" class="form-control">
                            </div>
                            <div style="display: flex; align-items: end;">
                                <button class="btn btn-success" onclick="reservationManager.addSingleDateToSelection()" style="margin-bottom: 0.5rem;">
                                    <i class="fas fa-plus"></i> Adicionar
                                </button>
                            </div>
                        </div>
                        
                        <div class="date-picker-container">
                            <div class="date-input-group">
                                <label class="form-label">Adicionar Período</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                    <input type="date" id="periodStartDate" class="form-control" placeholder="Início">
                                    <input type="date" id="periodEndDate" class="form-control" placeholder="Fim">
                                </div>
                            </div>
                            <div style="display: flex; align-items: end;">
                                <button class="btn btn-info" onclick="reservationManager.addDateRangeToSelection()" style="margin-bottom: 0.5rem;">
                                    <i class="fas fa-calendar"></i> Adicionar Período
                                </button>
                            </div>
                        </div>

                        <!-- Datas Selecionadas -->
                        <div class="selected-dates">
                            <h5>Datas Selecionadas:</h5>
                            <div id="selectedDatesList">
                                <p style="color: #666; font-style: italic;">Nenhuma data selecionada</p>
                            </div>
                            <div class="quick-actions" style="margin-top: 1rem;">
                                <button class="btn btn-sm btn-danger" onclick="reservationManager.clearDateSelection()">
                                    <i class="fas fa-trash"></i> Limpar Todas as Datas
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="navigation-buttons">
                        <button class="btn btn-secondary" onclick="reservationManager.goToStep(2)">
                            <i class="fas fa-arrow-left"></i> Voltar
                        </button>
                        <button class="btn btn-primary" onclick="reservationManager.goToStep(4)">
                            Próximo <i class="fas fa-arrow-right"></i> Confirmar
                        </button>
                    </div>
                </div>

                <!-- PASSO 4: Confirmação -->
                <div class="flow-section" id="step4-content">
                    <div class="card">
                        <h4 class="section-title"><i class="fas fa-check-circle"></i> Confirmar Reserva</h4>
                        
                        <div class="reservation-summary">
                            <div class="summary-section">
                                <h5><i class="fas fa-users"></i> Hóspedes</h5>
                                <div id="summaryGuests"></div>
                            </div>
                            
                            <div class="summary-section">
                                <h5><i class="fas fa-bed"></i> Quarto</h5>
                                <div id="summaryRoom"></div>
                            </div>
                            
                            <div class="summary-section">
                                <h5><i class="fas fa-calendar-alt"></i> Datas</h5>
                                <div id="summaryDates"></div>
                            </div>
                        </div>
                    </div>

                    <div class="navigation-buttons">
                        <button class="btn btn-secondary" onclick="reservationManager.goToStep(3)">
                            <i class="fas fa-arrow-left"></i> Voltar
                        </button>
                        <button class="btn btn-success" onclick="reservationManager.createReservation()">
                            <i class="fas fa-check"></i> Criar Reserva
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Gerenciar Reserva (EXPANDIDO) -->
    <div id="manageReservationModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="card-title">Gerenciar Reserva</h3>
                <span class="close" onclick="reservationManager.closeManageModal()">&times;</span>
            </div>
            <div class="management-card">
                <div id="manageReservationContent">
                    <!-- Conteúdo dinâmico será carregado aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Adicionar Datas -->
    <div id="addDatesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="card-title">Adicionar Datas</h3>
                <span class="close" onclick="reservationManager.closeAddDatesModal()">&times;</span>
            </div>
            <div class="form-group">
                <label class="form-label">Nova Data</label>
                <input type="date" id="newSingleDate" class="form-control">
            </div>
            <div class="form-group">
                <label class="form-label">Ou período (múltiplas datas)</label>
                <div class="reservation-form">
                    <div class="form-group">
                        <input type="date" id="newCheckInDate" class="form-control" placeholder="Entrada">
                    </div>
                    <div class="form-group">
                        <input type="date" id="newCheckOutDate" class="form-control" placeholder="Saída">
                    </div>
                </div>
            </div>
            <div id="dateAvailabilityResult"></div>
            <div class="quick-actions">
                <button class="btn btn-success" onclick="reservationManager.checkDateAvailability()">
                    Verificar Disponibilidade
                </button>
                <button class="btn btn-primary" onclick="reservationManager.addSingleDate()">
                    Adicionar Data Única
                </button>
                <button class="btn btn-info" onclick="reservationManager.addDateRange()">
                    Adicionar Período
                </button>
                <button class="btn btn-danger" onclick="reservationManager.closeAddDatesModal()">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Adicionar Quarto -->
    <div id="addRoomModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="card-title">Adicionar Quarto</h3>
                <span class="close" onclick="reservationManager.closeAddRoomModal()">&times;</span>
            </div>
            <div class="form-group">
                <label class="form-label">Número do Quarto</label>
                <input type="number" id="newRoomNumber" class="form-control" placeholder="Número do quarto">
            </div>
            <div class="quick-actions">
                <button class="btn btn-primary" onclick="reservationManager.addRoom()">
                    Adicionar Quarto
                </button>
                <button class="btn btn-danger" onclick="reservationManager.closeAddRoomModal()">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Detalhes da Reserva -->
    <div id="reservationDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="card-title">Detalhes da Reserva</h3>
                <span class="close" onclick="document.getElementById('reservationDetailsModal').style.display = 'none'">&times;</span>
            </div>
            <div id="reservationDetailsContent">
                <!-- Conteúdo dinâmico será carregado aqui -->
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p><strong>&copy; Interactive Edge System - Gerenciamento de Reservas</strong></p>
        </div>
    </footer>

    <script th:src="@{/js/reserve.js}"></script>
</body>
</html>